<!DOCTYPE html>
<html lang="en" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="htr3n&#39;s blog :: technology, opinions, and rants about everything">
    <meta name="keywords" content="blog,java,php,python,golang,javascript,shell,thoughts,rants,vietnamese,tiếng việt,parental,family,apache,httpd,laravel,politics,critical thinking, tư duy phản biện, luật, hiến pháp">
    <meta name="generator" content="Hugo 0.39-DEV" />
    
    <title>The Journey from Apache CXF 2.2 to 3.2 &middot; htr3n&#39;s</title>
    <meta content="The Journey from Apache CXF 2.2 to 3.2 - htr3n&#39;s" property="og:title">
    <meta content="htr3n&#39;s blog :: technology, opinions, and rants about everything - " property="og:description">
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400i,700,700i|Noto+Sans:400,400i,700,700i|Source+Code+Pro:400,400i" rel="stylesheet">
    <link rel="stylesheet" href="https://htr3n.github.io/css/print.css" media="print">
    <link rel="stylesheet" href="https://htr3n.github.io/css/poole.css">
    <link rel="stylesheet" href="https://htr3n.github.io/css/hyde.css">
    <!-- Font-Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>
    <!-- highlight.js-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/zenburn.min.css">
    <!-- Customised CSS -->
    <link rel="stylesheet" href="https://htr3n.github.io/css/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

	</head>
    <body class=" ">
        <div class="sidebar">
  <div class="container text-center ">
    <div class="sidebar-about text-center">
      <a href="https://htr3n.github.io/"><h1 class="brand">htr3n&#39;s</h1></a>
       <img src="/img/avatar.png" alt="Author Image" class="img-circle headshot center"> 
      <p class="lead">
         technology, thoughts, opinions, rants 
      </p>
    </div>
    
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="/posts/"> <span>Posts</span></a>
				</li>
				<li>
					<a href="/memo/"> <span>Memo</span></a>
				</li>
				<li>
					<a href="https://github.com/htr3n/"> <span>Code</span></a>
				</li>
				<li>
					<a href="/about/"> <span>About</span></a>
				</li>
				<li>
					<a href="/vn/"> <span>Tiếng Việt</span></a>
				</li>
		</li>
	</ul>
</div>

    <p>
      <section class="row text-center">
	
	<a href="https://twitter.com/htr3n"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://github.com/htr3n"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	&nbsp;<a href="https://bitbucket.org/hoanghuytran"><i class="fab fa-bitbucket fa-lg" aria-hidden="true"></i></a>
	
	
	&nbsp;<a href="https://gitlab.com/htr3n"><i class="fab fa-gitlab fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://linkedin.com/in/htr3n"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	&nbsp;<a href="https://stackoverflow.com/users/339302"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	&nbsp;<a href="mailto:hoang.huy.tran&#43;blog@gmail.com"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

    </p>
    <p class="copyright">&copy; 2018 htr3n.
      <a href="https://creativecommons.org/licenses/by/4.0">Some Rights Reserved</a>.<br/>Built with <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            <div class="post">
  <h1>The Journey from Apache CXF 2.2 to 3.2</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       
        <i class="fas fa-calendar-alt"></i> Jun 15, 2018
      
      
        
        
            in
            
            
                <a class="meta" href="/categories/dev">DEV</a>
                
            
        
      
      
      
        
        
            <br/>
             <i class="fas fa-tags"></i>
            
            <a class="meta" href="/tags/apache-cxf">apache-cxf</a> 
        
            <a class="meta" href="/tags/jaxws">jaxws</a> 
        
            <a class="meta" href="/tags/migration">migration</a> 
        
            <a class="meta" href="/tags/spring-framework">spring-framework</a> 
        
            <a class="meta" href="/tags/web-service">web-service</a> 
        
            <a class="meta" href="/tags/wsdl">wsdl</a> 
        
            <a class="meta" href="/tags/wsdl2java">wsdl2java</a>
        
      
      
      <br/>
      <i class="fas fa-clock"></i> 6 min read 
      </span>  
  </div>    
  
  

<p>I have used <a href="https://cxf.apache.org">Apache CXF</a> 2.2 to develop Web services for some R&amp;D projects that I took part in. At that time, I considered either <a href="http://axis.apache.org/axis2/java/core">Apache Axis/Axis2</a> or CXF (formerly Codehaus XFire project). I eventually decided to get along with CXF due to its simplicity, quite clear documentation, good support for document-style Web services (+) and many standards, especially JAX-WS and JAX-RS that I really loved. Moreover, Apache CXF also embraces smooth integration with Spring Framework (big plus for me as I was using Spring Web MVC 3 to develop a front-end).</p>

<p>Everything went well for the development of Web services based on JAX-WS for both directions: WSDL-first and Java-first. In my projects, I designed the WSDLs and used <a href="http://cxf.apache.org/docs/wsdl-to-java.html">WSDL2Java</a> Maven plugin or command line to generate skeleton Java code of the Web services. The Java service implementations were kept separately in a package/folder to avoid any code overwriting. CXF services are so easy to configure with Spring Framework 3.0. The implementations of the services were loaded as Spring managed beans. The expose of a service is done via a CXF directive <code>&lt;jaxws:endpoint&gt;</code> of which the <code>implementor</code> attribute refers to the corresponding bean.</p>

<pre><code class="language-xml">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:jaxws=&quot;http://cxf.apache.org/jaxws&quot;&gt;
	&lt;import resource=&quot;classpath:META-INF/cxf/cxf.xml&quot; /&gt;
	&lt;import resource=&quot;classpath:META-INF/cxf/cxf-extension-soap.xml&quot; /&gt;
	&lt;import resource=&quot;classpath:META-INF/cxf/cxf-extension-jaxws.xml&quot; /&gt;
	&lt;import resource=&quot;classpath:META-INF/cxf/cxf-servlet.xml&quot; /&gt;    
    &lt;bean
          id=&quot;CreditWorthinessImpl&quot;
          class=&quot;westbank.ws.impl.CreditWorthinessImpl&quot;
          p:dataAccessObject-ref=&quot;dataAccessObject&quot;&gt;
    &lt;/bean&gt;
    &lt;jaxws:endpoint id=&quot;CreditWorthiness&quot;
                    implementor=&quot;#CreditWorthinessImpl&quot; 
                    address=&quot;/CreditWorthiness&quot;&gt;
    &lt;/jaxws:endpoint&gt;
&lt;/beans&gt;
</code></pre>

<p>In the Web app configuration <code>web.xml</code>, CXF Servlet must be loaded by the container.</p>

<pre><code class="language-xml">&lt;servlet&gt;
    &lt;servlet-name&gt;cxf&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet&lt;/servlet-class&gt;
    &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;cxf&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/services/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>

<h2 id="upgrading-apache-cxf">Upgrading Apache CXF</h2>

<p>It was a while I haven&rsquo;t taken part in further WS development, i.e. not using Apache CXF a lot. One day I thought I could use the WS project to showcase and review my relevant knowledge. The project still works well after some mysterious library missing (that I have not seen before). It is possible due to the built-in libraries for XML parsing that were implicitly used but now changed in the newer JRE. Apart from that, most of the libraries are outdated. So I dedice to spend some time to exercise on the project to upgrade the libraries and refactor source code. Here I only note down some major points on upgrading Apache CXF.</p>

<p>The upgrading was not as easy and smooth as just changing the version numbers. A lot of conflicts or refactoring happened. I have to read thoroughly the <a href="http://cxf.apache.org/docs/migration-guides.html">documentation on CXF site for migration</a> and decide to go gradually over each major version of Apache CXF.</p>

<h2 id="from-cxf-2-2-to-2-7">&hellip; from CXF 2.2 to 2.7 &hellip;</h2>

<p>Since Apache CXF 2.2 to 2.6, not much of the changes are relevant for the project as I mainly used <code>cxf-rt-frontend-jaxws</code>.</p>

<p>Another <a href="http://cxf.apache.org/docs/embedding-cxf-inside-spring.html">significant change since 2.4</a> causes errors for Spring / Jetty server regarding importing CXF resources. Recall the aforementioned Spring bean configuration where CXF service implementation was loaded? There are a number of <code>&lt;import&gt;</code> directives. They indicate Spring and Jetty to load the corresponding CXF resources. Now we only need <em>one to rule them all</em>.</p>

<pre><code class="language-xml">&lt;import resource=&quot;classpath:META-INF/cxf/cxf.xml&quot; /&gt;
</code></pre>

<p>Since CXF 2.6 I have to revise the project with respect to the merging of <code>cxf-common-utilites</code> into <code>cxf-api</code>, the removal of <code>cxf-rt-binding-http</code>, and the refactoring that impact <code>cxf-rt-core</code>.  Most of the other changes from 2.2 to 2.7 focus on JAX-RS that was used very little or none in my project.</p>

<h2 id="and-to-cxf-3-0">&hellip; and to CXF 3.0+</h2>

<p>Apache CXF 3.0 requires a rather disruptive change, from Spring Framework 3.0 to 3.2 or newer. Again, I have almost used standard Spring bean configurations which are still valid for Spring 3.2. Hence, the project works well with Spring 3.2.18-RELEASE.</p>

<p>The first major change I had to make here is to remove the dependency of <code>cxf-api</code> as it was merged with <code>cxf-core</code>.</p>

<p>However, the most dramatic issue with CXF 3.0.16 is that, the <code>cxf-codegen-plugin</code> failed to generate Java code from WSDLs (which was no problem before) and spit out errors like this.</p>

<pre><code>[ERROR] Failed to execute goal org.apache.cxf:cxf-codegen-plugin:3.0.16:wsdl2java (generate-sources) on project loan-approval-portal: Execution generate-sources of goal org.apache.cxf:cxf-codegen-plugin:3.0.16:wsdl2java failed: org.apache.cxf.wsdl11.WSDLRuntimeException: Fail to create wsdl definition file:%3c?xml%20version=%221.0%22%20encoding=%22UTF-8%22?%3e: WSDLException: faultCode=PARSER_ERROR: Problem parsing 'file:%3c?xml%20version=%221.0%22%20encoding=%22UTF-8%22?%3e'.: java.io.FileNotFoundException: &lt; (No such file or directory) -&gt; [Help 1]
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal org.apache.cxf:cxf-codegen-plugin:3.0.16:wsdl2java (generate-sources) on project loan-approval-portal: Execution generate-sources of goal org.apache.cxf:cxf-codegen-plugin:3.0.16:wsdl2java failed: org.apache.cxf.wsdl11.WSDLRuntimeException: Fail to create wsdl definition file:%3c?xml%20version=%221.0%22%20encoding=%22UTF-8%22?%3e: WSDLException: faultCode=PARSER_ERROR: Problem parsing 'file:%3c?xml%20version=%221.0%22%20encoding=%22UTF-8%22?%3e'.: java.io.FileNotFoundException: &lt; (No such file or directory)
</code></pre>

<p>What puzzles me is that I have tried the command tool <code>wsdl2java</code> of Apache CXF 3.0.16 with each WSDL and, strangely, found no errors at all. After some extra trial-and-error effort, I figure out that an extra option for <code>cxf-codegen-plugin</code> causes the error. The old/original plugin configuration in <code>pom.xml</code> is as following.</p>

<pre><code class="language-xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
    &lt;artifactId&gt;cxf-codegen-plugin&lt;/artifactId&gt;
    &lt;version&gt;${cxf.version}&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;generate-sources&lt;/id&gt;
            &lt;phase&gt;generate-sources&lt;/phase&gt;
            &lt;configuration&gt;
                &lt;sourceRoot&gt;${basedir}/src/main/java&lt;/sourceRoot&gt;
                &lt;wsdlRoot&gt;${basedir}/src/main/webapp/WEB-INF/wsdl/&lt;/wsdlRoot&gt;
                &lt;defaultOptions&gt;
                    &lt;validateWsdl&gt;true&lt;/validateWsdl&gt;
                    &lt;wsdlList&gt;true&lt;/wsdlList&gt;
                    &lt;defaultExcludesNamespace&gt;true&lt;/defaultExcludesNamespace&gt;
                    &lt;extraargs&gt;
                        &lt;extraarg&gt;-defaultValues&lt;/extraarg&gt;
                        &lt;extraarg&gt;-quiet&lt;/extraarg&gt;
                        &lt;extraarg&gt;-wsdlLocation&lt;/extraarg&gt;
                        &lt;extraarg&gt;&lt;/extraarg&gt;
                    &lt;/extraargs&gt;
                &lt;/defaultOptions&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
                &lt;goal&gt;wsdl2java&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>

<p>The option <code>&lt;wsdlList&gt;</code> was declared <code>boolean</code> since CXF 2.2 to 2.7.0 as I found <a href="https://cxf.apache.org/javadoc/latest-2.7.x/org/apache/cxf/maven_plugin/wsdl2java/Option.html">here</a>. However, in <a href="http://cxf.apache.org/docs/wsdl-to-java.html">the most recent documentation</a> of CXF 3, <code>wsdlList</code> is still listed as an option for <code>wsdl2java</code> but no longer <code>boolean</code> but a wsdlurl <code>-wsdlList &lt;wsdlurl&gt;</code> and undocumented. All I have to do is to remove/comment the line <code>&lt;wsdlList&gt;true&lt;/wsdlList&gt;</code> so that the <code>cxf-codegen-plugin</code> works in CXF 3.0+.</p>

<p>The problems with <code>cxf-codegen-plugin</code> keep raising when upgrading CXF to 3.2.4. This time, it threw another exception though.</p>

<pre><code>[ERROR] Failed to execute goal org.apache.cxf:cxf-codegen-plugin:3.2.4:wsdl2java (generate-sources) on project loan-approval-portal: Execution generate-sources of goal org.apache.cxf:cxf-codegen-plugin:3.2.4:wsdl2java failed: org.xml.sax.SAXNotRecognizedException: Property 'http://javax.xml.XMLConstants/property/accessExternalSchema' is not recognized. -&gt; [Help 1]
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal org.apache.cxf:cxf-codegen-plugin:3.2.4:wsdl2java (generate-sources) on project loan-approval-portal: Execution generate-sources of goal org.apache.cxf:cxf-codegen-plugin:3.2.4:wsdl2java failed: org.xml.sax.SAXNotRecognizedException: Property 'http://javax.xml.XMLConstants/property/accessExternalSchema' is not recognized.
</code></pre>

<p>We can see that the error is due to schema validation. Before, I wanted to make sure that the WSDLs were valid before generating Java code. Thus, I chose to enable validation by <code>&lt;validateWsdl&gt;true&lt;/validateWsdl&gt;</code>. This option is actually the root cause the aforementioned exception during validation. The problem seems to stem from <a href="http://docs.oracle.com/javase/tutorial/jaxp/properties/properties.html">new XML security properties in JAXB 1.5</a> introduced in Java 8. When I disable that option, the plugin works fine again (voila!). But that means I must live in a maybe-not-error-free world (D&rsquo;oh!). But we are all, aren&rsquo;t we?</p>

<p>After all of the above, I can get my project to work with Apache CXF 3.2.4 while keeping the business logic of services intact.</p>

<h3 id="update-2018-06-25-xml-less-spring-configuration">Update 2018-06-25: XML-less Spring Configuration</h3>

<p>As deciding to switch to XML-less Spring configuration to learn more about Spring Java annotations, I also tried to migrate CXF settings, too. Here are some last updates.</p>

<h4 id="loading-cxfservlet">Loading CXFServlet</h4>

<pre><code class="language-java">public class MyWebApplicationInitializer implements org.springframework.web.WebApplicationInitializer {
    @Override
    public void onStartup(ServletContext container) throws ServletException {
        AnnotationConfigWebApplicationContext rootContext = new AnnotationConfigWebApplicationContext();
        rootContext.register(ServiceConfiguration.class);
        rootContext.refresh();      
        // Register and map the CXF servlet
        CXFServlet cxfServlet = new CXFServlet();
        ServletRegistration.Dynamic registration = container.addServlet(&quot;cxf&quot;, cxfServlet);
        registration.setLoadOnStartup(1);
        registration.addMapping(&quot;/services/*&quot;);      
    }
}
</code></pre>

<h4 id="publishing-services">Publishing Services</h4>

<p>I configured the CXF bus used for publishing web services and defining JAX-WS service endpoints. Instead of importing CXF&rsquo;s <code>.xml</code> resources as many developers have chosen, I opted for a pure Java approach. What we have to do is to create a bean named &lsquo;<strong>cxf</strong>&rsquo; (defined as <code>org.apache.cxf.Bus.DEFAULT_BUS_ID</code>) and use that bean for defining service endpoints.</p>

<pre><code class="language-java">import com.example.HelloWorldImpl;

import org.apache.cxf.Bus;
import org.apache.cxf.bus.spring.SpringBus;
import org.apache.cxf.jaxws.EndpointImpl;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.xml.ws.Endpoint;

@Configuration
public class ServiceConfiguration {

    @Bean(name=Bus.DEFAULT_BUS_ID)
    public SpringBus cxf() {
        return new SpringBus();
    }

    @Bean
    public Endpoint helloWorld() {
        HelloWorldImpl implementor = new HelloWorldImpl();
        EndpointImpl endpoint = new EndpointImpl(cxf(), implementor);
        endpoint.publish(&quot;/HelloWorld&quot;);
        return endpoint;
    }
}
</code></pre>

<blockquote>
<p>IMPORTANT: <code>Endpoint.publish()</code> must be called to expose the service instead of <code>Endpoint.setAddress()</code> as above.</p>
</blockquote>

</div>
            <div class="footer">
                <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
</script>

    

        <h2>Comments</h2>
        <div id="disqus_thread"></div>
<script type="text/javascript">
      (function () {
            
            
            
            if (location.hostname === "localhost" || 
            	location.hostname === "127.0.0.1" || 
            	location.hostname === "") {
                return;
			}
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            var disqus_shortname = 'https-htr3n-github-io';
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(
                  dsq);
      })();
</script>

<noscript>
	Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      

            </div>
        </div>
        
        
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-112764962-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

    </body>
</html>
