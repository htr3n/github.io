<!DOCTYPE html><html lang="en"><head><link href="https://gmpg.org/xfn/11" rel="profile"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Cache-Control" content="public"><!-- Enable responsiveness on mobile devices --><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="generator" content="Hugo 0.52"><title>Tour de Spring Boot: DI meets CoC • htr3n&#39;s</title><meta name="description" content="htr3n&#39;s blog :: technology, thoughts, opinions, and rants"><meta name="keywords" content="blog,java,php,python,golang,javascript,shell,thoughts,macos,apple,tiếng việt,parental,family,apache,httpd,laravel,politics,critical thinking,chính trị,luật,hiến pháp,xã hội,gia đình"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Tour de Spring Boot: DI meets CoC"><meta name="twitter:description" content="I started using Spring framework few years back in 2009 to develop demo systems for some EU projects. These projects featured a number of Web services some of which share back-end databases and some other talk to external services or WS-BPEL business processes."><meta property="og:title" content="Tour de Spring Boot: DI meets CoC"><meta property="og:description" content="I started using Spring framework few years back in 2009 to develop demo systems for some EU projects. These projects featured a number of Web services some of which share back-end databases and some other talk to external services or WS-BPEL business processes."><meta property="og:type" content="article"><meta property="og:url" content="https://htr3n.github.io/2018/12/spring-boot-di-meets-coc/"><meta property="article:published_time" content="2018-12-04T00:00:00&#43;00:00"><meta property="article:modified_time" content="2018-12-04T00:00:00&#43;00:00"><link href="https://fonts.googleapis.com/css?family=IBM+Plex+Serif" rel="stylesheet"><link rel="stylesheet" href="https://htr3n.github.io/scss/hyde-hyde.css"><link rel="stylesheet" href="https://htr3n.github.io/scss/print.css" media="print"><!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --><!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]--><!-- Icons --><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png"><link rel="shortcut icon" href="/favicon.png"></head><body class=""><div class="sidebar"><div class=""><div class="sidebar-about"><span class="site__title"><a href="https://htr3n.github.io/">htr3n&#39;s</a></span><div class="author-image"><img src="https://htr3n.github.io//img/avatar.png" alt="Author Image" class="img--circle img--headshot element--center"></div><p class="site__description"></p></div><div class="collapsible-menu"><input type="checkbox" id="menuToggle"> <label for="menuToggle">htr3n&#39;s</label><div class="menu-content"><div><ul class="sidebar-nav"><li><a href="/posts/"><span>Posts</span></a></li><li><a href="/portfolio/"><span>Portfolio</span></a></li><li><a href="/vn/"><span>Tiếng Việt</span></a></li><li><a href="/about/"><span>About</span></a></li></ul></div><section class="social"><a href="https://twitter.com/htr3n" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a> <a href="https://github.com/htr3n" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a> <a href="https://linkedin.com/in/htr3n" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a> <a href="https://stackoverflow.com/users/339302" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a> <a href="https://keybase.io/htr3n" rel="me"><i class="fab fa-keybase fa-lg" aria-hidden="true"></i></a> <a href="mailto:hoang.huy.tran&#43;blog@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a></section></div></div><div class="copyright">&copy; 2018 htr3n <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a></div><div class="builtwith">Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.</div></div></div><div class="content container"><article><header><h1>Tour de Spring Boot: DI meets CoC</h1><div class="post__meta"><i class="fas fa-calendar-alt"></i> Dec 4, 2018 in <a class="badge badge-category" href="/categories/dev">DEV</a><br><i class="fas fa-tags"></i> <a class="badge badge-tag" href="/tags/spring-framework">spring framework</a> <a class="badge badge-tag" href="/tags/spring-boot">spring boot</a> <a class="badge badge-tag" href="/tags/dependency-injection">dependency injection</a> <a class="badge badge-tag" href="/tags/convention-over-configuration">convention over configuration</a> <a class="badge badge-tag" href="/tags/software-design">software design</a> <a class="badge badge-tag" href="/tags/auto-configuration">auto-configuration</a> <a class="badge badge-tag" href="/tags/productivity">productivity</a> <a class="badge badge-tag" href="/tags/java">java</a><br><i class="fas fa-clock"></i> 12 min read</div></header><div class="post"><p>I started using Spring framework few years back in 2009 to develop demo systems for some EU projects. These projects featured a number of Web services some of which share back-end databases and some other talk to external services or WS-BPEL business processes.</p><p>The <a href="https://en.wikipedia.org/wiki/Dependency_injection">dependency injection</a> implemented in Spring works so well and on top of that, many other parts like Spring MVC, data access, transactions messaging and even some third-party libraries such as Apache <a href="http://activemq.apache.org/">ActiveMQ</a>, Apache <a href="http://cxf.apache.org/">CXF</a> and JBoss (now Red Hat and likely IBM) <a href="http://hibernate.org/orm/">Hibernate ORM</a>, and many other helper libraries all came to play nicely.</p><p>One of my concerns is that configuring a complex Spring based project is truly tedious and error-prone. I have made countless trial-and errors and gone through lots of warning and errors, not to mention XML verbosity and complexity, Maven dependency hell, the conflicts or incompatibilities among numerous dependencies. Fast forward to 2018 I want to refresh my experience through existing Spring projects. I was thinking about similar rough paths when upgrading Spring and Hibernate to some prior versions until discovering <a href="http://spring.io/projects/spring-boot">Spring Boot</a>.</p><p>To be precise, Spring Boot is not a magic wand that would help us to navigate through the forest of Spring framework complexity or automatically resolve certain problems. It is more or less some sort of <a href="https://en.wikipedia.org/wiki/Convention_over_configuration"><em>convention over configuration</em></a> that might reduce significant effort on making Spring applications quickly up and running as well as ensure better compatibilities among integrated libraries.</p><h2 id="quickstart">A Quick Start</h2><p>Let&rsquo;s consider the following Java code defining a REST controller for an endpoint &ldquo;<code>/</code>&rdquo; that shall display a greeting.</p><pre><code class="language-java">@RestController
class HelloWorld {
  
  @RequestMapping(&quot;/&quot;)
  public String hello(){
    return &quot;Hello World!&quot;;
  }
}
</code></pre><p>Just with this very minimal code, we can have a working Spring application. Assume that the <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/cli.html">Spring Boot CLI</a> is available, start our application with the following command.</p><pre><code class="language-sh">spring run HelloWorld.java
</code></pre><p>Spring Boot will launch an embedded Tomcat server and initialise a Web application to serve the endpoint at &ldquo;<a href="http://localhost:8080">http://localhost:8080</a>&rdquo;. Visiting this address will give us &ldquo;<em>Hello World!</em>&rdquo;. What could be cooler than that !?</p><p>Now, let&rsquo;s start a quick tour on some more appealing features that Spring Boot 2.1.0 offers.</p><h2 id="bootstrapping">Project Bootstrapping</h2><p>Using <a href="https://start.spring.io/">Spring Initializr</a> directly or via IDE /CLI, we can quickly bootstrap a dead simple or full-blown Spring development project. For instance, this command will create a Spring application development project, namely, <code>hello-world</code>, with JPA and H2 database.</p><pre><code class="language-sh">spring init --dependencies=web,data-jpa,h2 hello-world
</code></pre><p>After asking some questions such as the project&rsquo;s and package&rsquo;s names, the command line will download the core package and create a new development project that is ready to be imported to any IDE. Other than that, Eclipse or IntelliJ IDEA can just walk you through simple wizards in which you can craft your own project and choose the necessary components for the new project.</p><p><img src="spring-boot-in-ide.png" alt="Spring Boot project in Eclipse"></p><h2 id="dependency-management">Build and Dependency Management</h2><p>Spring Boot 2 works with Spring Framework 5 and requires at least Java 8. You can either choose Maven or Gradle build system when creating the project. An excerpt of Maven <code>pom.xml</code> (stripped off few minor details) of our project is shown below.</p><div><pre><code class="language-xml">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;io.github.htr3n&lt;/groupId&gt;
  &lt;artifactId&gt;hello-world&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;name&gt;hello-world&lt;/name&gt;
  &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    
  &lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;
    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
  &lt;/parent&gt;
    
  &lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
  &lt;/properties&gt;
    
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.h2database&lt;/groupId&gt;
      &lt;artifactId&gt;h2&lt;/artifactId&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;
</code></pre><div class="code--caption">A simplified <code>pom.xml</code></div></div><p>This POM inherits many <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-build-systems.html#using-boot-maven">useful default settings and values</a> from <code>spring-boot-starter-parent</code>. We might opt to not use <code>spring-boot-starter-parent</code> and go old-school to set everything up on our own. I have just recalled working with Spring 3 and trying to integrate an embedded Jetty server. I really struggled with different Jetty versions as well as other libraries to make them click. When I tried to upgrade the legacy projects to newer Spring and Hibernate versions, things all turned out really messy with loads of mysterious errors.</p><p>Spring Boot eases this kind of burden with some opinionated design and configuration decisions. We can truly leverage its strength and choose among a set of <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-build-systems.html#using-boot-starter">starters</a> (beginning with <code>spring-boot-starter-</code>). The starters are intended for better compatiblity and smooth integration.</p><p>In the <code>hello-world</code> project, we have chosen three components <code>spring-boot-starter-data-jpa</code> (JPA), <code>spring-boot-starter-web</code> (Web), <code>spring-boot-starter-test</code> (for testing) along with <code>mysql-connector-java</code> (MySQL).</p><h2 id="autoconfiguration">Autoconfiguration</h2><p>Intelligent autoconfiguration is perhaps one of the most prominent and important parts of Spring Boot. There are different levels of configuring a Spring based application. The simplest form of autoconfiguration is the &ldquo;<em>Hello World</em>&rdquo; example mentioned above. The new Maven based project created via the wizard or command line consists of <code>pom.xml</code> along with <code>application.properties</code>, <code>HelloWorldApplication.java</code> and <code>HelloWorldApplicationTest.java</code> as shown in Figure 1.</p><pre><code class="language-java">package io.github.htr3n;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class HelloWorldApplication {

  public static void main(String[] args) {
    SpringApplication.run(HelloWorldApplication.class, args);
  }
}
</code></pre><p>The <code>HelloWorldApplication</code> class is annotated with <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/autoconfigure/SpringBootApplication.html"><code>@SpringBootApplication</code></a> which is actually an umbrella for three annotations:</p><ul><li><a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/autoconfigure/EnableAutoConfiguration.html"><code>@EnableAutoConfiguration</code></a> that triggers auto-configuration of Spring application context.</li><li><a href="https://docs.spring.io/spring-framework/docs/5.1.2.RELEASE/javadoc-api/org/springframework/context/annotation/ComponentScan.html?is-external=true"><code>@ComponentScan</code></a> that enables the scanning of classes annotated with <code>@Component</code> or its sub-types on the package where the application is located (that&rsquo;s why <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-structuring-your-code.html#using-boot-locating-the-main-class">it is often recommended</a> to place the class annotated with <code>@SpringBootApplication</code> at the root package above other classes)</li><li><a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/SpringBootConfiguration.html"><code>@SpringBootConfiguration</code></a> is an alias to <a href="https://docs.spring.io/spring-framework/docs/5.1.2.RELEASE/javadoc-api/org/springframework/context/annotation/Configuration.html?is-external=true"><code>@Configuration</code></a> allows for registering some more beans in the context or import additional configuration classes</li></ul><p>The aforementioned annotations are sufficient to launch not-so-complex Spring applications. In case one wants to fine-tune the application context autoloading, individual annocations mentioned above and/or customised annotations can be leveraged.</p><p>Examining the Spring Boot <a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure">auto-configure project</a> on Github, we can see many <a href="https://github.com/spring-projects/spring-boot/blob/v2.1.0.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories">scripts</a> for essential libraries. Depending on what are detected on the classpath and the application-specific configuration directives, Spring Boot will automatically include and configure the corresponding components.</p><p>We can explicitly disable certain parts using <code>@EnableAutoConfiguration(exclude={class1, class2, ...})</code> or the directive &ldquo;<code>spring.autoconfigure.exclude=class1, class2, ...</code>&rdquo; in <code>application.properties</code>.</p><h3 id="app-launcher-configuration">App Launcher Configuration</h3><p>The <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/SpringApplication.html"><code>SpringApplication</code></a> class is the main launcher of a Spring application. Prior to Spring Boot, in order to start a Spring app we have to manually initialise an <a href="https://docs.spring.io/spring-framework/docs/5.1.2.RELEASE/javadoc-api/org/springframework/context/ApplicationContext.html?is-external=true"><code>ApplicationContext</code></a>, parse system- and application-specific properties and input arguments (if needed), load all necessary beans and/or launch an embedded Web server like <a href="https://tomcat.apache.org/">Tomcat</a> or <a href="https://www.eclipse.org/jetty/">Jetty</a>. Now, all of these tasks will be automatically done using <code>SpringApplication</code> with <code>@SpringBootApplication</code> (or a combination of its sub-annotations).</p><p>Apart from <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html#boot-features-external-config-application-property-files"><code>application.properties</code></a> (or <code>.yml</code>), we can configure and customise a Spring app using a <code>SpringApplication</code> or <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html#boot-features-fluent-builder-api"><code>SpringApplicationBuilder</code></a> instance. For instance, the following code will turn off the banner when launching our Spring app</p><pre><code class="language-java">public static void main(String[] args) {
  SpringApplication app = new SpringApplication(HelloWorldApplication.class);
  app.setBannerMode(Banner.Mode.OFF);
  app.run(args);
}
</code></pre><p>which is equivalent to <code>spring.main.banner-mode=off</code> in <code>application.properties</code>. Spring Boot comes with numerous predefined properties. Indeed, almost every autoconfigured component offers some default property settings. These predefined settings will be overriden with our own settings, if exist.</p><h3 id="properties-loading">Properties Loading</h3><p>By default, Spring Boot will bind external properties from <code>application.properties</code> (or <code>.yml</code>) at runtime. That is called <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">externalized configuration</a>. More details on application properties can be found <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html">here</a>.</p><blockquote class="warning"><strong>Warning</strong><br>Please beware of the trailing whitespaces in Spring <code>.properties</code> as Spring Boot <a href="https://github.com/spring-projects/spring-boot/issues/4106#issuecomment-173278825">won&rsquo;t trim off any of them</a> and in some cases that might lead to unexpected issues or even crash the applications (see <a href="/2018/11/spring-boot-trailing-whitespaces/">my other relevant post</a>)</blockquote><p>Besides the default <code>application.properties</code>, Spring allows us to activate various profiles using the naming convention <code>application-{profile}.properties</code>. It comes very handy in case we look forward to separating testing-specific environments, for example, using <code>application-test.properties</code>, from production environments. We can still ask to load property sources with <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a> as usual in Spring.</p><h3 id="components-and-beans-configuration">Components and Beans Configuration</h3><p>Other components and bean configurations can be loaded from different sources including XML files, Java classes (with <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html"><code>@Configuration</code></a>), or Groovy (also annotated with <code>@Configuration</code> as Java or via Groovy <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/cli-groovy-beans-dsl.html">Beans DSL</a> &ldquo;<code>beans {...}</code>&rdquo;).</p><p>Note that, all components in the sub-paths under the main class annotated with <code>@SpringBootApplication</code> will be automatically scanned and initialised. The rest of beans configuration will be handed over to Spring&rsquo;s <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-spring-beans-and-dependency-injection.html"><em>dependency injection mechanism</em></a>.</p><h3 id="web-configuration">Web Configuration</h3><p>Spring Boot often <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html#boot-features-web-environment">tries to establish</a> an appropriate <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/ApplicationContext.html"><code>ApplicationContext</code></a> based on classpath scanning and app-specific configurations. For instance, to enable the traditional Spring Web MVC, I simply include the component <code>spring-boot-starter-web</code> in the POM as <a href="#dependency-management">shown in the previous section</a>. Spring Boot will automatically adds relevant components for resolving and serving Web pages and resources.</p><p>We can add extra components such as <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">WebFlux</a>&mdash;the reactive framework added in Spring 5+ (<code>spring-boot-starter-webflux</code>), <a href="https://www.thymeleaf.org/">Thymeleaf</a> template engine (<code>spring-boot-starter-thymeleaf</code>), Spring Web services (<code>spring-boot-starter-web-services</code>) and <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#websocket">WebSocket</a> (<code>spring-boot-starter-websocket</code>).</p><p>Spring <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Web MVC</a> is totally capable to handle most of HTTP requests via <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">servlets</a> or <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/stereotype/Controller.html">controllers</a> like the simple Hello World example above. Should you need more advanced control of RESTful endpoints, just add either one of <a href="http://spring.io/projects/spring-hateoas">Spring HATEOAS</a> (<code>spring-boot-starter-hateoas</code>), <a href="https://jersey.github.io/">Jersey</a> (<code>spring-boot-starter-jersey</code>) or <a href="https://cxf.apache.org/">Apache CXF</a>.</p><p>By default, the Web starter will use Tomcat as the underlying embedded application server. When we opt for another server, we must explicitly exclude Tomcat and add either <code>spring-boot-starter-jetty</code> (Jetty) or <code>spring-boot-starter-undertow</code> (Undertow) in our POM.</p><pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
  &lt;exclusions&gt;
    &lt;exclusion&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
    &lt;/exclusion&gt;
  &lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><p>Many of the embedded server&rsquo;s settings can be defined in <code>application.properties</code> such as the network address, port, sessions, and so on. These settings can also be done programmatically by defining bean implementing <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/web/server/WebServerFactoryCustomizer.html"><code>WebServerFactoryCustomizer</code></a> that enables access to customise the underlying <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/web/server/WebServerFactory.html"><code>WebServerFactory</code></a>. For instance, you can refer to more fine-tuned customisations for <a href="https://github.com/spring-projects/spring-boot/blob/v2.1.0.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/embedded/JettyWebServerFactoryCustomizer.java">Jetty</a>, <a href="https://github.com/spring-projects/spring-boot/blobv2.1.0.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/embedded/TomcatWebServerFactoryCustomizer.java">Tomcat</a>, or <a href="https://github.com/spring-projects/spring-boot/blob/v2.1.0.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/embedded/UndertowWebServerFactoryCustomizer.java">Undertow</a>.</p><p>Following up our example on excluding Tomcat and adding Jetty, we can create a simple bean to change the Jetty server from the default port <code>8080</code> to <code>9999</code>.</p><pre><code class="language-java">package io.github.htr3n;

import org.springframework.boot.web.server.ConfigurableWebServerFactory;
import org.springframework.boot.web.server.WebServerFactoryCustomizer;
import org.springframework.stereotype.Component;

@Component
public class JettyServerCustomizer implements WebServerFactoryCustomizer&lt;ConfigurableWebServerFactory&gt; {

  @Override
  public void customize(ConfigurableWebServerFactory factory) {
    factory.setPort(9999);
  }
}
</code></pre><h3 id="data-access-configuration">Data Access Configuration</h3><p>Going through various versions, Spring framework always provides considerable support and different abstraction levels for <a href="http://spring.io/projects/spring-data">database access</a>. In general, it often requires some configurations for data sources and sometimes the intermediate layers such as pooling or caching.</p><p>Spring Boot has taken further steps forward by auto-configuring in some popular circumstances, for instance, embedded databases, database pooling, to name but a few. What we need to do is to add appropriate dependencies. In the <code>hello-world</code> project, <a href="https://www.h2database.com/html/main.html">H2 database engine</a> will be auto-configured by Spring Boot.</p><pre><code class="language-xml">&lt;dependencies&gt;
  ...
  &lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
  &lt;/dependency&gt;
  ...
&lt;/dependencies&gt;
</code></pre><p>Note that, including database dependencies alone won&rsquo;t trigger any auto-configuration. It&rsquo;s only when Spring Boot found some sort of data access components such as <code>spring-boot-starter-jdbc</code>, <code>spring-boot-starter-data-jpa</code> (which transitively embraces <code>spring-jdbc</code>) on the classpath.</p><p>Atop the data connection layer, Spring Boot takes the liberty of <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-sql.html#boot-features-connect-to-production-database">choosing other data access components</a>. Note that the design decisions taken by Spring Boot are often based on some popular and widely-used conventions in Spring based application developments. The decisions for data access, like other components, can be overriden with our own information. For example, I can define my own H2 data source in <code>application.properties</code>.</p><pre><code class="language-properties">spring.datasource.url=jdbc:h2:mem:helloword_db;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=sa
</code></pre><p>Next, Spring Boot will try to initialise the database. High level data access components such as <a href="https://spring.io/projects/spring-data-jpa">Spring Data JPA</a>, <a href="http://hibernate.org/orm/">Hibernate</a> can be customised via <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-database-initialization.html#howto-database-initialization">specific properties</a>. Nonetheless, Spring Boot can look into the classpath for a <a href="https://en.wikipedia.org/wiki/Data_definition_language">schema definition script</a>, namely, <code>schema.sql</code>, and a <a href="https://en.wikipedia.org/wiki/Data_manipulation_language">data manipulation script</a>, namely, <code>data.sql</code> and execute them if found. Here is an example of these scripts for a simple database <code>customer</code>.</p><pre><code class="language-sql">-- schema.sql
DROP TABLE customer;
CREATE TABLE customer(
  id integer not null auto_increment,
  name varchar(255) not null,
  email varchar (255) not null,
  primary key (id)
);
-- data.sql
INSERT INTO customer(name, email) VALUES ('Bob', 'bob@test.com');
</code></pre><p>Instead, you may indicate the initialising scripts for specific databases using the naming convention <code>schema-${platform}.sql</code> and <code>data-${platform}.sql</code> where <code>platform</code> is taken from <code>spring.datasource.platform</code>. This convention helps us to separate vendor-specific data creation and manipulation scripts.</p><p>Last but not least, Spring Boot classpath scanning mechanism may help us to entirely skip JPA&rsquo;s <code>persistence.xml</code> as it will try to search for all classes annotated with <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/Entity.html"><code>@Entity</code></a>, <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/Embeddable.html"><code>@Embeddable</code></a>, or <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/MappedSuperclass.html"><code>@MappedSuperclass</code></a> in our application&rsquo;s classpath.</p><h2 id="development-support">Development Support</h2><h3 id="testing">Testing</h3><p>Testing is always a crucial part of any development process and Spring apps are no exception. That&rsquo;s why Spring Boot provides <code>spring-boot-starter-test</code> that comprises several handy components such as <a href="https://junit.org/junit4/">JUnit</a>, <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html">Spring Tests</a>, <a href="https://site.mockito.org/">Mockito</a>, to name but a few.</p><pre><code class="language-java">import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

@RunWith(SpringRunner.class)
@SpringBootTest
public class ` {  
  @Test
  public void contextLoads() {
  }
}
</code></pre><p>Consider inside the project <code>hello-world</code>, we have a simple class <code>HelloWorldApplicationTests</code> annotated with <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/context/SpringBootTest.html"><code>@SpringBootTest</code></a> that detects and initialises Spring Boot&rsquo;s application context and testing environment. We can fine tune the testing environment in a similar manner as production&rsquo;s (i.e. with <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html"><code>@Configuration</code></a>, <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/context/ContextConfiguration.html"><code>@ContextConfiguration</code></a> along with <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/context/TestConfiguration.html"><code>@TestConfiguration</code></a>).</p><p>We won&rsquo;t delve into evey detail of testing support but you can find <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/test-auto-configuration.html">an extensive list of test auto-configurations</a> for JDBC, JPA, Neo, Redis, REST, Web MVC, and WebFlux as well as a rich documentation of Spring Boot testing features <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">here</a>.</p><p>In <a href="/2018/11/test-driven-spring-jdbc/">one of my previous posts</a>, we can see that the annotation <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/autoconfigure/jdbc/JdbcTest.html"><code>@JdbcTest</code></a> has simplified a lot of settings needed for loading up databases, testing CRUD app with automatic transactions. As such it truly helps me better focus on the actual testing logics.</p><h3 id="troubleshooting">Troubleshooting</h3><p>In order to dig deeper or to resolve bugs for our Spring apps, we may need more detailed information on logs and traces. Just start the Spring application under analysis with the command line option&rdquo;<code>--debug</code>&rdquo;, system property &ldquo;<code>-Ddebug</code>&rdquo;, or set &ldquo;<code>debug=true</code>&rdquo; in <code>application.properties</code>. Here is an example of enabling debugging using command line.</p><pre><code class="language-sh">mvn spring-boot:run --debug
</code></pre><p>The &ldquo;<code>--debug</code>&rdquo; option will enable the <code>DEBUG</code> logging level for <em>some selected core Spring components</em>. Likewise, we can also enable <code>TRACE</code> logging level with the &ldquo;<code>--trace&quot;</code> or &ldquo;<code>trace=true</code>&rdquo; in <code>application.properties</code>.</p><h3 id="developer-tools">Developer Tools</h3><p>Spring Boot equips us&mdash;Spring app developers&mdash;with a set of nice tools in hope that our life might become less miserable, or so they said ;)</p><pre><code class="language-xml">&lt;dependencies&gt;
  ...
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
    &lt;optional&gt;true&lt;/optional&gt;
  &lt;/dependency&gt;
  ...
&lt;/dependencies&gt;
</code></pre><p>One of my favourie features provided by <code>spring-boot-devtools</code> is <em>automatic restart</em>. That is, a Spring app can automatically reload whenever any changes on the classpath are detected. As <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-devtools.html#using-boot-devtools-restart">stated in the documentation</a>, it works really well with <a href="https://livereload.com/">LiveReload</a> to instantly refresh the corresponding Web browsers. The <em>automatic restart</em> feature mimics <a href="https://zeroturnaround.com/software/jrebel/">JRebel</a> but in a slower and less advanced manner using two classloaders: a <em>base classloader</em> for unchanged resources and a <em>restart classloader</em> for changable ones.</p><h2 id="finale">Finale</h2><p>Most of the decisions taken in Spring Boot are opinionated and some might like or dislike, especially hard-core experienced developers who know deeply about Spring.</p><p>Fairly speaking, the way Spring Boot hides the underneath complexity turns out rather ideal for beginners. An inexperienced developer can start the journey with minimal effort and configuration to have a running application. After that, more and more advanced configurations or features can be gradually added or customised until we no longer rely on Spring Boot. Instead of struggling with complex settings, Spring app developers can now better concentrate on the core system business logics to be designed and implemented.</p><p>Having said that, a Spring lover like me would truly appreciate the ideas and massive efforts behind the Spring Boot project to achieve an integrated set of various in-house and third-party libraries working smoothly. I think Spring development teams have made some bold and good decisions. With simple starting points and open to a plethora of advanced features, configurations and customisations, even experienced teams and developers would greatly benefit from that with more focused system designs and better speed of development.</p></div><div class="navigation navigation-single"><a href="/2018/11/spring-boot-trailing-whitespaces/" class="navigation-prev"><i aria-hidden="true" class="fa fa-chevron-left"></i> <span class="navigation-tittle">Spring Boot properties issues with trailing whitespaces</span></a></div><div class="post__related"><h2>Related Articles</h2><ul class="related-posts"><li><span class="list__title--small"><a href="/2018/11/test-driven-spring-jdbc/">Back to basics: Test-driven Spring JDBC</a> <time class="pull-right hidden-tablet">Nov 20 &#39;18</time></span></li><li><span class="list__title--small"><a href="/2018/11/spring-boot-trailing-whitespaces/">Spring Boot properties issues with trailing whitespaces</a> <time class="pull-right hidden-tablet">Nov 27 &#39;18</time></span></li></ul></div><div id="disqus_thread"></div><script type="text/javascript">(function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'https-htr3n-github-io';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></article></div><script type="application/javascript">var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-112764962-1', 'auto');
	
	ga('send', 'pageview');
}</script><script async src="https://www.google-analytics.com/analytics.js"></script><script defer="defer" src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script><noscript id="deferred-styles"><link rel="stylesheet" type="text/css" href="/css/new-moon.css"><link rel="stylesheet" type="text/css" href="/css/codecopy.min.css"></noscript><script>var loadDeferredStyles = function () {
    var addStylesNode = document.getElementById("deferred-styles");
    if (addStylesNode) {
      var replacement = document.createElement("div");
      replacement.innerHTML = addStylesNode.textContent;
      document.body.appendChild(replacement);
      addStylesNode.parentElement.removeChild(addStylesNode);
    }
  };
  var raf = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
    window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
  if (raf) raf(function () {
    window.setTimeout(loadDeferredStyles, 0);
  });
  else
    window.addEventListener('load', loadDeferredStyles);
  
  document.addEventListener('DOMContentLoaded', function (event) {
    codecopy('pre');
  });</script><script defer="defer" src="/js/codecopy.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script><script type="text/javascript">hljs.initHighlightingOnLoad();</script></body></html>