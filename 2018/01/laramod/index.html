<!DOCTYPE html>
<html lang="en">
    <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.44-DEV" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="LaraMod - Modularised Laravel 5"/>
<meta name="twitter:description" content="Laravel is an amazing emerging, well-designed and well-developed PHP framework. It is currently under active development and has been among top Web development frameworks. The latest version of Laravel 5 imposes a conventional project structure that is well documented here. For a simple development project, the structure is totally fine. Nevertheless, unless some necesssary configurations you might not want to mix up your development codes and resources with Laravel&rsquo;s. And you might also want to organise your project into submodules that are assigned to more than one team/person such that they can be developed silmutaneously."/>

<meta property="og:title" content="LaraMod - Modularised Laravel 5" />
<meta property="og:description" content="Laravel is an amazing emerging, well-designed and well-developed PHP framework. It is currently under active development and has been among top Web development frameworks. The latest version of Laravel 5 imposes a conventional project structure that is well documented here. For a simple development project, the structure is totally fine. Nevertheless, unless some necesssary configurations you might not want to mix up your development codes and resources with Laravel&rsquo;s. And you might also want to organise your project into submodules that are assigned to more than one team/person such that they can be developed silmutaneously." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://htr3n.github.io/2018/01/laramod/" />
<meta property="article:published_time" content="2018-01-19T00:00:00&#43;00:00"/><meta property="article:modified_time" content="2018-04-25T00:00:00&#43;00:00"/>





    <!-- Web fonts -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700|Source+Code+Pro:400,400i" rel="stylesheet">

    <!-- Font-Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/solid.css" integrity="sha384-TbilV5Lbhlwdyc4RuIV/JhD8NR+BfMrvz4BL5QFa2we1hQu6wvREr3v6XSRfCTRp" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/brands.css" integrity="sha384-7xAnn7Zm3QC1jFjVc1A6v/toepoG3JXboQYzbM0jrPzou9OFXm/fY6Z/XiIebl/k" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/fontawesome.css" integrity="sha384-ozJwkrqb90Oa3ZNb+yKFW2lToAWYdTiF1vt8JiH5ptTGHTGcN7qdoR1F95e0kYyG" crossorigin="anonymous">
    <!-- highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
    <link rel="stylesheet" href="https://htr3n.github.io/css/print.min.css" media="print">
    <link rel="stylesheet" href="https://htr3n.github.io/css/hyde-hyde.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png"></head>
    <body>
        
<div class="sidebar text-center">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://htr3n.github.io">htr3n&#39;s</a>
      </span>
      
      <img src="/img/avatar.png" alt="Author Image" class="img--circle img--headshot element--center"> 
      <p class="site__description">
         technology, thoughts, opinions, rants 
      </p>
    </div>
    <div>
	<ul class="sidebar-nav">
		
				<li>
					<a href="/posts/">
						<span>Articles</span>
					</a>
				</li>
				<li>
					<a href="/portfolio/">
						<span>Portfolio</span>
					</a>
				</li>
				<li>
					<a href="/vn/">
						<span>Tiếng Việt</span>
					</a>
				</li>
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
		</li>
	</ul>
</div>

    <p>
      <section class="social text-center">
	<a href="https://twitter.com/htr3n"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	&nbsp;<a href="https://github.com/htr3n"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	&nbsp;<a href="https://bitbucket.org/hoanghuytran"><i class="fab fa-bitbucket fa-lg" aria-hidden="true"></i></a>
	&nbsp;<a href="https://gitlab.com/htr3n"><i class="fab fa-gitlab fa-lg" aria-hidden="true"></i></a>
	
	&nbsp;<a href="https://linkedin.com/in/htr3n"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	&nbsp;<a href="https://stackoverflow.com/users/339302"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="mailto:hoang.huy.tran&#43;blog@gmail.com"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
</section>

    </p>
    <p class="copyright">&copy; 2018 htr3n.
      <a href="https://creativecommons.org/licenses/by-sa/4.0">Some Rights Reserved</a>.
      <br/>Built with
      <a href="https://gohugo.io">Hugo</a> ❤️
      <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
    </p>
  </div>
  <div>
  </div>
</div>
<div class="content container">
            <article>
  <header>
    <h1>LaraMod - Modularised Laravel 5</h1>
     
    
<div class="meta">
    
    <i class="fas fa-calendar-alt"></i> Jan 19, 2018
    in
              <a class="category" href="/categories/dev">DEV</a>
              
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="tag" href="/tags/laramod">#laramod</a>
           
      
          <a class="tag" href="/tags/laravel">#laravel</a>
           
      
          <a class="tag" href="/tags/modularisation">#modularisation</a>
           
      
          <a class="tag" href="/tags/php">#php</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 6 min read
</div>

  </header>
  <div class="post">
    

<p><a href="https://laravel.com">Laravel</a> is an amazing emerging, well-designed and well-developed PHP framework. It is currently under active development and has been among top Web development frameworks. The latest version of Laravel 5 imposes a conventional project structure that is well documented <a href="https://laravel.com/docs/5.5/structure">here</a>. For a simple development project, the structure is totally fine. Nevertheless, unless some necesssary configurations you might not want to mix up your development codes and resources with Laravel&rsquo;s. And you might also want to organise your project into submodules that are assigned to more than one team/person such that they can be developed silmutaneously. Thus, the need for complex submodule organisation is quite obvious.</p>

<p>From my struggle to organise a Laravel-based project such that I can divide and work on individual submodules such as <code>UserManagement</code>, <code>Authentication</code>, <code>Dashboard</code>, etc. whilst keeping the Laravel code base intact as much as possible (this could be convenient for upgrading Laravel) and keeping my code base separate from Laravel&rsquo;s. There are a number decent attempts on modalurasing Laravel projects for example <a href="https://nicolaswidart.com/blog/writing-modular-applications-with-laravel-modules">here</a>, <a href="https://github.com/caffeinated/modules">here</a> or <a href="http://kamranahmed.info/blog/2015/12/03/creating-a-modular-application-in-laravel">here</a>. Being inspired and learning from these articles, I decided to start a simple project on my own, namely, <a href="https://github.com/htr3n/laramod"><code>LaraMod</code></a>, for many reasons, but the biggest one is to dig deeper into Laravel 5 and PHP.</p>

<p>Here I only emphasize some major aspects of LaraMod. The rest, including code and extra improvements can be found at LaraMod&rsquo;s <a href="https://github.com/htr3n/LaraMod">repository</a>.</p>

<p><strong>Update 1 on 2018-04-25</strong>: LaraMod has been revised and updated to work with the most recent version of Laravel framework, 5.6.17. Instead of a standalone git repos, LaraMod is now a fork of <a href="https://github.com/laravel/laravel">Laravel repos</a> and updated with modularisation.</p>

<h2 id="modularising-laravel-5">Modularising Laravel 5</h2>

<h3 id="a-simple-submodule-structure">A Simple Submodule Structure</h3>

<p>Assuming that I want to divide my project into submodules of which each comprises own controllers, views, models (MVC) and others such as database migration, i18n, and routes. A simple structure of the submodule <code>Authentication</code> is shown as following.</p>

<pre><code>Authentication
├──Controllers
├──Lang
├──Migrations
├──Models
├──View
└──routes.php
</code></pre>

<p>Such a structure can be very useful for different teams/people working independently. In LaraMod, there is an <code>artisan</code> command <code>gen:module</code> provided in <a href="https://github.com/htr3n/laramod/blob/master/app/Console/Commands/GenModuleCommand.php"><code>App\Console\Commands\GenModuleCommand</code></a> that can quickly create a submodule following that structure.</p>

<pre><code class="language-sh">$ php artisan gen:module Authentication
</code></pre>

<h3 id="how-to-proceed">How to Proceed</h3>

<p>An easy approach is to rely on Laravel&rsquo;s <a href="https://laravel.com/docs/providers"><code>ServiceProvider</code></a> to load the submodules and register the necessary components of the submodules.</p>

<pre><code class="language-php">class XYZServiceProvider extends \Illuminate\Support\ServiceProvider {
  	public function boot() {}
	public function register() {}
}
</code></pre>

<p>A <code>ServiceProvider</code> contains two important methods <code>register()</code> and <code>boot()</code>. In this case, LaraMod mainly uses the method <code>boot()</code> to load the corresponding submodule. LaraMod also adopts a simple, conventional method for defining a submodule. That is, all submodules will be subfolders of the folder <code>/modules</code> and each module follows the conventional structure as mentioned above.</p>

<h4 id="automatically-loading-submodules">Automatically Loading Submodules</h4>

<h5 id="loading-a-submodule">Loading a Submodule</h5>

<p>First, we create a method <code>loadModule()</code> to load the resources such as views, i18n, database migration, and routes of a submodule using the provided methods <code>loadViewsFrom()</code>, <code>loadTranslationsFrom()</code>, <code>loadMigrationsFrom()</code>, <code>loadRoutesFrom()</code>, respectively. As models and controllers are essential PHP classes, they can be loaded using PSR-4 autoloaders as shown in the next parts.</p>

<pre><code class="language-php">protected function loadModule($module)
{
    if ($module) {

        // load the submodule's routes
        if (file_exists(__DIR__ . '/' . $module . '/routes.php')) {
            $this-&gt;loadRoutesFrom(__DIR__ . '/' . $module . '/routes.php');
        }

        // load the submodule's views
        if (is_dir(__DIR__ . '/' . $module . '/Views')) {
            $this-&gt;loadViewsFrom(__DIR__ . '/' . $module . '/Views', $module);
        }

        // load the submodule's translation
        if (is_dir(__DIR__ . '/' . $module . '/Lang')) {
            $this-&gt;loadTranslationsFrom(__DIR__ . '/' . $module . '/Lang', $module);
        }

        // load the submodule's database migrations
        if (is_dir(__DIR__ . '/' . $module . '/Migrations')) {
            $this-&gt;loadMigrationsFrom(__DIR__ . '/' . $module . '/Migrations', $module);
        }
    }
}
</code></pre>

<h5 id="detecting-and-loading-submodules">Detecting and Loading Submodules</h5>

<p>Then we can walk through the folder <code>module</code> and load all submodules using the method <code>loadModule()</code>.</p>

<pre><code class="language-php">protected function findAndLoadModules()
{
    $modules = config(&quot;module.modules&quot;);

    if (!$modules) {
        $modules = $this-&gt;getModuleNamesFromCurrentPath();
    }

    if ($modules) {
        array_walk($modules, function ($module) {
            $this-&gt;loadModule($module);
        });
    }
}
</code></pre>

<p>Note that in this conventional approach, <code>findAndLoadModules()</code> will look for submodule configurations either (1) explicitly in the file <code>/config/module.php</code> with the following syntax or (2) implicitly as subfolders of <code>/modules</code> (in case <code>/config/module.php</code> does not exist).</p>

<pre><code class="language-php">&lt;?php
return  [
    'modules' =&gt; [
        'Core',
        'Login',
        'Dashboard',
        'Home',
        'User',
    ]
];
</code></pre>

<p>Finally we invoke <code>findAndLoadModules()</code> within <code>boot()</code>.</p>

<pre><code class="language-php">namespace Laramod;

class ModulesServiceProvider extends \Illuminate\Support\ServiceProvider {
  	public function boot() 
  	{
		$this-&gt;findAndLoadModules();
	}
	public function register() 
	{
	}
}
</code></pre>

<h4 id="registering-the-service-provider">Registering the Service Provider</h4>

<p>The <code>ModulesServiceProvider</code> must be registered in <code>/config/app.php</code> in order to be loaded by Laravel.</p>

<pre><code class="language-php">'providers' =&gt; [
	...
	\Laramod\ModulesServiceProvider::class,
]
</code></pre>

<h4 id="autoloading-submodules-classes">Autoloading Submodules&rsquo; Classes</h4>

<p>Apart from resources like views, i18n, database migration loaded in the previous steps, a submodule can also contain other PHP classes such as database ORM models and controllers.</p>

<p>One natural approach would be to leverage the <a href="http://www.php-fig.org/psr/psr-4">PSR-4 autoloader</a> autoloading supported by Laravel 5.5. This approach also nicely fits when we want to define separate namespaces for each submodule and especially submodule&rsquo;s components.</p>

<p>For this, we can define the submodule&rsquo;s namespace and manually specify the submodule&rsquo;s classpaths to be loaded in <code>composer.json</code> as following.</p>

<pre><code class="language-json">{
	&quot;psr-4&quot;: {
      &quot;App\\&quot;: &quot;app/&quot;,
      &quot;Core\\&quot;: &quot;modules/Core/&quot;,
      &quot;Dashboard\\&quot;: &quot;modules/Dashboard/&quot;,
      &quot;Login\\&quot;: &quot;modules/Login/&quot;,
      &quot;User\\&quot;: &quot;modules/User/&quot;
    }
}
</code></pre>

<p>Another technique for autoloading classes in Laravel 5 is to dynamically add PSR4 classpaths in <code>ModulesServiceProvider.php</code>.</p>

<pre><code class="language-php">$loader = require base_path() . '/vendor/autoload.php';
$loader-&gt;setPsr4(&quot;Core\\&quot;, __DIR__ . &quot;./Core/&quot;);
$loader-&gt;setPsr4(&quot;Dashboard\\&quot;, __DIR__ . &quot;./Dashboard/&quot;);
$loader-&gt;setPsr4(&quot;Login\\&quot;, __DIR__ . &quot;./Login/&quot;);
$loader-&gt;setPsr4(&quot;User\\&quot;, __DIR__ . &quot;./User/&quot;);
</code></pre>

<p>One problem, though, is that LaraMod must be able to detect or guess the namespace classpaths. To do this, we can either use the configuration file <code>config/module.php</code> or, even nicer and smarter, scan the submodule&rsquo;s folders to extract the necessary information. However, loading time then will be really significant when the project grows because Laravel loaders willl do the scanning and loading whenever any classes are referenced.</p>

<h3 id="accessing-submodule-resources">Accessing Submodule Resources</h3>

<p>Given a submodule, for instance <code>SubmoduleA</code>, most of its classes such as controllers and database mapping models, if configuring properly using PSR-4, will be automatically loaded and used straightforwardly. Nonetheless, acessing to resources such as views and i18n (languages) requires a slightly different syntax, for instance, <code>SubmoduleA::blade_view_name</code> or <code>SubmoduleA::messages.error</code>. If the <code>SubmoduleA::</code> is missing, Laravel will look for views and language files in the default places.</p>

<h2 id="finale">Finale</h2>

<p>The outcome of my very first PHP project, LaraMod, would be a reasonable skeleton for modularising software projects based on Laravel 5. That is, you can just easily create a new submodule with the predefined conventional structure and add the PSR-4 namespaces and classpaths, then good you go. Each submodule should then be developed independently. Sure there are some areas that need improvement. For example, all testing stuffs are still under <code>/tests</code> and database seeders are still in <code>database/seeds</code>. The first one requires intervention with PHPUnit/<code>phpunit.xml</code> whilst the later asks for further changes in built-in Laravel <code>artisan</code> commands.</p>

<p>For me &ndash; a new bie, it was not quite an all-pleasant journey to experience several Laravel&rsquo;s aspects. Nevertheless, developing and customising LaraMod are extremely valuable as I could learn a lot about not only Laravel in particular but also PHP in general. Achieving reasonable modularisation for a complex software development project requires a lot of thoughtful design and hard work and even sometimes trade-offs and compromises. In sharing this, I hope LaraMod might become handy and helpful start so that your journeys with Laravel can be more pleasant and joyful. I look forward to hearing and learning from your experience, too.</p>

  </div>
  <div class="page__nav">
    <hr>
    <div class="pull-right">
    <span><a href="/2018/01/first-experience-with-hugo/">First experience with Hugo</a></span> ▶
    </div>
    <div>
        ◀ <span><a href="/2017/09/apache-httpd-php-macos/">Apache httpd 2.4 and PHP 7 in macOS</a></span>
    </div>
</div>
  <div class="post__related">
    
    
    
    <h2>Related Articles</h2>
    <ul class="related-posts">
        
<li>
  <span class="list__title--small">
    <a href="/2017/09/apache-httpd-php-macos/">Apache httpd 2.4 and PHP 7 in macOS</a>
      
      <time class="pull-right hidden-tablet">Sep 25 &#39;17</time>
      
  </span>
</li>

    </ul>
    
</div>
</article>
        </div>
        <div class="container content"><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
</script>
<div id="disqus_thread"></div>
<script type="text/javascript">
      (function () {
            
            
            
            if (location.hostname === "localhost" || 
            	location.hostname === "127.0.0.1" || 
            	location.hostname === "") {
                return;
			}
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            var disqus_shortname = 'https-htr3n-github-io';
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(
                  dsq);
      })();
</script>

<noscript>
	Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
    <!-- Google Analytics -->

<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-112764962-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </body>
</html>
